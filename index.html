function doPost(e) {
  try {
    var sheet = SpreadsheetApp.openById("1-0Rfs7YoPuVdiMUa9u4bruUXVfowwIdsNh-dgR0RDH8").getActiveSheet();
    var data = JSON.parse(e.postData.contents);

    Logger.log("受け取ったデータ: " + JSON.stringify(data));

    sheet.appendRow([
      new Date(),
      data.customerName,
      data.product,
      data.quantity,
      data.price,
      data.quantity * data.price
    ]);

    // ✅ CORS対応のヘッダーを追加
    var output = ContentService.createTextOutput(JSON.stringify({ status: "success" }))
      .setMimeType(ContentService.MimeType.JSON);

    return output.setHeaders({
      "Access-Control-Allow-Origin": "*", 
      "Access-Control-Allow-Methods": "POST",
      "Access-Control-Allow-Headers": "Content-Type"
    });

  } catch (error) {
    Logger.log("エラー: " + error);
    return ContentService.createTextOutput(JSON.stringify({ status: "error", message: error.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
